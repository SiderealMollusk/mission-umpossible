FROM node:20-slim

WORKDIR /app

RUN apt-get update && apt-get install -y procps

RUN npm install -g concurrently nodemon ts-node typescript

# -- Frontend: install first for Docker caching --
WORKDIR /app/mu-admin
COPY mu-admin/package*.json ./
RUN npm install

# -- Backend: install next --
WORKDIR /app/mu-api
COPY mu-api/package*.json ./
RUN npm install

# -- Now copy all project files (after install) --
WORKDIR /app
COPY . .

# -- Run both servers --
CMD ["concurrently", "npm --prefix mu-api run dev", "npm --prefix mu-admin run dev"]