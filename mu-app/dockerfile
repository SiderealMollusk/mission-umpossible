# Use a slim Node.js base image for reduced vulnerabilities
FROM node:20-slim

# Set working directory
WORKDIR /app

# Install global development tools
RUN npm install -g concurrently nodemon ts-node typescript

# Copy application files
COPY . .

# Install frontend dependencies
WORKDIR /app/mu-admin
RUN npm install

# Install backend dependencies
WORKDIR /app/mu-api
RUN npm install

# Return to root directory
WORKDIR /app

# Start both frontend and backend concurrently
CMD ["concurrently", "npm --prefix mu-api run dev", "npm --prefix mu-admin run dev"]